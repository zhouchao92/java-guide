# Flink Runtime核心机制剖析

[【【Apache Flink 进阶教程】1. Flink Runtime核心机制剖析】](https://www.bilibili.com/video/BV1y4411a7Bz)

[Flink Runtime 核心机制剖析.pdf](./ppt/2.1%20Flink%20Runtime%20核心机制剖析.pdf)

[官方文档：Flink 架构](https://nightlies.apache.org/flink/flink-docs-release-1.13/zh/docs/concepts/flink-architecture/)

![Flink 整体架构](/pic/flink/Flink%20整体架构.png)

![Flink Runtime 层总体架构](/pic/flink/Flink%20Runtime%20层总体架构.png)



# Flink Time 深度解析

[【【Apache Flink 进阶教程】2. Flink Time 深度解析】](https://www.bilibili.com/video/BV1G441177wT)

[Flink Time 深度解析.pdf](./ppt/2.2%20Flink%20Time%20深度解析.pdf)

![Flink 支持的时间语义](/pic/flink/Flink%20支持的时间语义.png)

![Flink Record Timestamp 分配和 Watermark 生成](/pic/flink/Flink%20Timestamp%20分配和%20Watermark%20生成.png)

Flink Watermark 传播：木桶效应/短板效应
![Flink Watermark 传播](/pic/flink/Flink%20Watermark%20传播.png)

Flink Table
![Flink Table 中指定时间列](/pic/flink/Flink%20Table%20中指定时间列.png)

时间和 Watermark 的本质
- 流处理中时间本质上就是一个普通的递增字段，不一定真的表示时间（例如：递增的主键ID）
- Watermark 只是**应对乱序**的办法之一，大多是启发式的，在延迟和完整性之间抉择


# Flink Checkpoint-轻量级分布式快照

[【【Apache Flink 进阶教程】3、Flink Checkpoint-轻量级分布式快照】](https://www.bilibili.com/video/BV1k4411H7JP)

[Flink Checkpoint-轻量级分布式快照.pdf](./ppt/2.3%20Flink%20Checkpoint-轻量级分布式快照.pdf)

[官方文档：状态快照](https://nightlies.apache.org/flink/flink-docs-release-1.13/zh/docs/learn-flink/fault_tolerance/#状态快照)

[官方文档：Flink Checkpoint](https://nightlies.apache.org/flink/flink-docs-release-1.13/zh/docs/dev/datastream/fault-tolerance/checkpointing/)

![Flink State 的存储](/pic/flink/Flink%20State%20的存储.png)


- HeapKeyedStateBackend 存储格式
	- 支持异步 checkpoint（默认）：`CopyOnWriteStateTable<K,N,S>[]`，整体相当于一个 map
	- 仅支持同步 checkpoint：`Map<N,Map<K,S>>[]`，由嵌套 map 的数组构成
	在 MemoryStateBackend 内使用时，checkpoint 序列化数据阶段默认有最大**5MB**数据的限制
- RocksDBKeyedStateBackend 存储格式
	每个 state 都存储在一个单独的 column family 内，keyGroup、Key 和 Namespace 仅需序列化存储在 DB 作为 key



# Flink on Yarn/K8S原理剖析及实践

[【【Apache Flink 进阶教程】4、Flink on Yarn/K8S原理剖析及实践】](https://www.bilibili.com/video/BV174411W7oC)

[Flink on Yarn/K8S原理剖析及实践.pdf](./ppt/2.4%20Flink%20on%20Yarn%20or%20K8S原理剖析及实践.pdf)




